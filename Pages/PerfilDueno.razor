@page "/PerfilDueno"
@using SocioWeb.Domain.Entities
@inject NavigationManager Nav

<RadzenLayout>
    <RadzenHeader>
        <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" Gap="0">
            <RadzenSidebarToggle Click="@(() => sidebar1Expanded = !sidebar1Expanded)" />
            <RadzenText> Header </RadzenText>
        </RadzenStack>
    </RadzenHeader>

    <RadzenSidebar @bind-Expanded="@sidebar1Expanded">
        <RadzenPanelMenu>
            <RadzenPanelMenuItem Text="Home" Icon="home" Path="/home" />
            <RadzenPanelMenuItem Text="Dueños" Icon="account_box" Path="/Duenos" />
            <RadzenPanelMenuItem Text="Mascotas" Icon="pets" Path="/mascotas" />
            <RadzenPanelMenuItem Text="Citas" Icon="event_note" Path="/citas" />
            <RadzenPanelMenuItem Text="Productos" Icon="store" Path="/productos" />
            <RadzenPanelMenuItem Text="Calendario" Icon="event" Path="/calendario" />
        </RadzenPanelMenu>
    </RadzenSidebar>

    <RadzenBody>
        <RadzenCard>

            <!-- Cabecera -->
            <div style="display:flex; gap:25px; align-items:center; margin-bottom:30px;">

                <div style="
                    width:120px; height:120px; border-radius:50%;
                    background:#d9d9d9; display:flex; align-items:center;
                    justify-content:center; font-size:50px; color:#6c6c6c;">
                    🐶
                </div>

                <div>
                    <h2 style="margin:0; color:#333;">@dueno.Name @dueno.LastName</h2>
                    <h4 style="margin:5px 0; color:#777;">Dueño registrado</h4>

                    @if (!isEditing)
                    {
                        <RadzenButton Text="Editar perfil" Icon="edit"
                                      Style="margin-right:10px; border-radius:10px;"
                                      Click="@(() => isEditing = true)" />
                    }
                    else
                    {
                        <RadzenButton Text="Cancelar" Icon="close"
                                      Style="margin-right:10px; border-radius:10px;"
                                      ButtonStyle="ButtonStyle.Danger"
                                      Click="@Cancelar" />
                    }

                    <RadzenButton Text="Ver mascotas" Icon="pets"
                                  ButtonStyle="ButtonStyle.Primary"
                                  Style="border-radius:10px; background:#4b3e48; color:white;"
                                  Click="@VerMascotas" />
                </div>
            </div>

            <!-- Datos personales -->
            <h3 style="color:#4b3e48; margin-bottom:20px;">Información personal</h3>

            <div style="display:grid; grid-template-columns:1fr 1fr; gap:25px; padding:10px;">

                @Campo("Nombre", dueno.Name, v => dueno.Name = v)
                @Campo("Apellido", dueno.LastName, v => dueno.LastName = v)
                @Campo("Número Identificación", dueno.IdentificationNumber, v => dueno.IdentificationNumber = v)
                @Campo("Email", dueno.Email, v => dueno.Email = v)
                @Campo("Teléfono", dueno.Phone, v => dueno.Phone = v)

                @Campo("Calle", dueno.Street, v => dueno.Street = v)
                @Campo("Código Postal", dueno.PostalCode, v => dueno.PostalCode = v)
                @Campo("Ciudad", dueno.City, v => dueno.City = v)

                @Campo("Estado de la app", dueno.StatusApp.ToString(), null)
                @Campo("Comentarios", dueno.Comentarios,v => dueno.Comentarios = v)
               

            </div>

            <hr style="margin:30px 0;" />

            <!-- Auditoría -->
            <h3 style="color:#4b3e48; margin-bottom:20px;">Registro del sistema</h3>

            <div style="display:grid; grid-template-columns:1fr 1fr; gap:25px;">
                @Campo("Creado el", dueno.CreatedAt.ToLocalTime().ToString(), null)
                @Campo("Última actualización", dueno.UpdatedAt?.ToLocalTime().ToString(), null)
            </div>

            @if (isEditing)
            {
                <div style="margin-top:30px; text-align:right;">
                    <RadzenButton Text="Guardar cambios"
                                  Icon="save"
                                  ButtonStyle="ButtonStyle.Primary"
                                  Style="background:#4b3e48; color:white; border-radius:10px;"
                                  Click="@Guardar" />
                </div>
            }

        </RadzenCard>
    </RadzenBody>

</RadzenLayout>

@code {

    bool sidebar1Expanded = true;
    bool isEditing = false;

    Dueno dueno = new()
    {
        Name = "Manolo",
        LastName = "Jiménez",
        IdentificationNumber = "12345678X",
        Email = "carlos@email.com",
        Phone = "555-123456",
        Street = "Calle Mayor 22",
        PostalCode = "28001",
        City = "Madrid",
        Comentarios = "",
        StatusApp = StatusApp.Activo,
        CreatedAt = DateTime.UtcNow,
        UpdatedAt = DateTime.UtcNow
    };

    void VerMascotas()
    {
        Nav.NavigateTo("/dueno/1/mascotas");
    }

    void Guardar()
    {
        // Aquí guardarías los cambios en DB
        dueno.UpdatedAt = DateTime.UtcNow;
        isEditing = false;
    }

    void Cancelar()
    {
        // Si quieres: recargar datos desde la BD
        isEditing = false;
    }


    // ⬇️ Componente reutilizable Campo()
    RenderFragment Campo(string label, string valor, Action<string>? onChange) => __builder =>
    {
        <div>
            <label style="color:#777;">@label</label>

            @if (!isEditing)
            {
                <div style="font-size:18px; color:#333;">
                    @valor
                    <RadzenIcon Icon="edit" Style="font-size:18px; color:#aaa; margin-left:8px;" />

                </div>
            }
            else
            {
                if (onChange != null)
                {
                    <RadzenTextBox Value="@valor"
                                   Change="@(e => onChange(e.ToString()))"
                                   Style="width:100%; background:white; border-radius:10px;" />
                }
                else
                {
                    <div style="font-size:18px; color:#333;">@valor</div>
                }
            }
        </div>;
    };
}
